!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class o{_removePrefix(){$(this).val($(this).val().replace(/OIT-/,""))}install(){$("#input-barcode, textarea[id^='rapid']").on("keydown",this._removePrefix)}}const r=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime),i=r?chrome.runtime:browser.runtime,s="https://webcheckout2.coe.uga.edu",a={},c={pullResource:function(e,t,n){return new Promise((function(o,r){n&&a.hasOwnProperty(e)&&o(a[e]),$.get(i.getURL(e)).then((function(r){if(t)for(let e in t)r=r.replace("${"+e+"}",t[e]);n&&(a[e]=r),o(r)}))}))},openLightBox:function(e,t){return $.featherlight(null,{html:e,afterOpen:t,openSpeed:-200})},objectContainsAll:function(e,t){for(let n of t)if(!(n in e))return!1;return!0},parseToDataString:function(e){try{let t=window.atob(e).split(/\s*,\s*/),n={};for(let e of t){let t=e.split(/\s*:\s*/),o=t[0],r=t[1];n[o]=r}return n}catch(e){return!1}},average:function(e){if(null==e||0==e.length)return 0;let t=0;for(let n of e)t+=n;return t/e.length},makeFrameRequest:function(e){const t=this;let n=!1,o=e.length,r=1,i=null,s=[],a=t.average(s),c=performance.now(),l=new Promise((function(l,u){if(0!=e.length){let d=e[0],h=d.other||{},p=d.feed||$.noop,f=d.stop||function(){return!1};return $.ajax({method:"POST",url:d.url,data:d.hasOwnProperty("data")?d.data:null,...h}).done(d=>{if(p(d),conditionalMessage=f(d))u(conditionalMessage);else{if(e.shift(),!n||0==e.length){if(null!=i&&"function"==typeof i){let t={completed:r+1,total:o,percent:(r+1)/o,remaining:(o-(r+1))*a/1e3};i.call(this,t,null!=e[0]?e[0]:null)}return s.push(performance.now()-c),t.makeFrameRequest(e).then(l,u).progress(i,o,++r,s)}u("cancelled")}}).fail((function(){$.post("?method=checkout-jump"),u("error")}))}l()}));return Promise.prototype.progress=function(n,c,l,u){o=c||e.length,r=l||0,i=n||$.noop,s=u||[],a=t.average(u)},Promise.prototype.cancel=function(){n=!0,$.post("?method=checkout-jump")},l},getAllocationId:function(){if(null==document.getElementById("allocation"))return;return document.getElementById("allocation").getAttribute("href").match(/allocation\=([0-9]+)/)[1]}};let l,u={CoeOitApi:{findUser:function(e){return new Promise((function(t,n){$.ajax({url:"https://coeoit.coe.uga.edu:47715/api/v1/webcheckout/user/"+e,type:"GET",crossDomain:!0,success:function(e){t(e)},error:function(e){n(r?"User does not exist in either systems.":"Adding Users is Temporarily Disabled on Firefox")}})}))}},addPerson:function(e){return c.makeFrameRequest([{url:"?method=new-person-wizard"},{url:"?method=new-userid-forward",data:{"new-userid-form.userid":e.ugaid,"new-userid-form.first-name":e.firstname,"new-userid-form.other-name":"","new-userid-form.last-name":e.lastname,"new-userid-form.patron-class":e.class,"new-userid-form.department":e.department},stop:function(e){let t=e.match(/NOTIFICATION-BAR="" STUFFED-NOTIFICATIONS\="(.*)"/);if(t)try{let e=t[1].replace(/\&quot\;/g,'"'),n=JSON.parse(e)[0];if("error"==n.type)return n.message}catch(e){return!1}return!1}},{url:"?method=new-person-contact-forward",data:{"new-person-contact-form.street":"","new-person-contact-form.street2":"","new-person-contact-form.city":"","new-person-contact-form.state":"","new-person-contact-form.postal-code":"","new-person-contact-form.country":"","new-person-contact-form.telephone":e.phone,"new-person-contact-form.email":e.email}},{url:"?method=new-person-create-finish"},{url:"?method=checkout-jump",finishing:!0}])},autocomplete:{resource:function(e){return new Promise((function(t,n){$.ajax({url:s+"/webcheckout/rest/resourceType/autocomplete",type:"POST",dataType:"json",data:`{"string": "${e}", "properties": ["name", "description"]}`,contentType:"application/json",headers:{Accept:"application/json, text/plain, */*"},xhrFields:{withCredentials:!0},success:function(e){if(null==e||null==e.payload)t([]);else{let n=[],o=e.payload;for(let e of o)if("OIT"==e.label)for(let t of e.values)n.push({oid:t.oid,name:t.name});t(n)}}})}))},person:function(e){return new Promise((function(t,n){$.ajax({url:s+"/webcheckout/rest/person/Autocomplete",type:"POST",dataType:"json",data:`{"string": "${e}", "limit": 30}`,contentType:"application/json",headers:{Accept:"application/json, text/plain, */*"},xhrFields:{withCredentials:!0},success:function(e){if(null==e||null==e.payload)t([]);else{for(let n of e.payload)if(null!=n.values)return void t(n.values);t([])}},error:function(e){console.error("FAIL",e)}})}))}},setPatron:function(e){return new Promise((function(t,n){$.ajax({url:s+"/webcheckout/wco/api/set-patron",type:"POST",data:{oid:e,timeline:!0,allocation:c.getAllocationId()},xhrFields:{withCredentials:!0},success:function(e){t(e.patron)}})}))},addResources:function(e){let t=[],n=function(e,t,n){return[{url:"?method=new-resource-wizard"},{url:"?method=choose-resource-id-forward",data:{"choose-resource-id-form.resource-id":e,"choose-resource-id-form.circulating":!0}},{url:"?method=choose-resource-type-forward",data:{"choose-resource-type-form.search-field":t}},{url:"?method=new-resource-wizard-finish",finishing:!0,feed:function(e){try{let t=/\?method=resource&caller=new-resource-wizard-done&resource=([0-9]*)/,o=e.match(t)[1];$.ajax({url:s+"/webcheckout/rest/resource/update",type:"POST",dataType:"json",data:'{"oid": '+o+', "values": {"description": "'+n+'"}}',contentType:"application/json",headers:{Accept:"application/json, text/plain, */*"},xhrFields:{withCredentials:!0},success:$.noop})}catch(e){console.error(e),alert("Oops, Something Went Wrong:"+e)}}}]};for(let o of e)t=t.concat(n(o.id,o.type,o.description));return c.makeFrameRequest(t)}};function d(e,t){let n=t||"default";document.getElementById("progress-prompt").innerHTML+=`<div class='${n}'>${e}</div>`,document.getElementById("progress-prompt").scrollTop=document.getElementById("progress-prompt").scrollHeight}function h(){let e=$(".featherlight-inner .content .well .row .form-control").length,t=$(".featherlight-inner .content .well .row .form-control").filter((function(){return $(this).hasClass("type")&&$(this).hasClass("autocompleted")||$(this).hasClass("numbers")&&$(this).val().match(/[0-9]{1,}/)||$(this).hasClass("description")})).length;$("#finishadding").attr("disabled",!(e==t))}function p(){document.location="?method=new-resource-wizard"}function f(){$(this).find(".row").length>1&&$(this).closest(".row").slideUp(200,(function(){$(this).remove(),h()}))}function m(e){$(".featherlight-inner .content .well").append(e),h()}function g(){let e=$(this).data("oid"),t=$(this).text();$(this).parent().prev().data("oid",e).val(t).addClass("autocompleted"),$(this).parent().empty(),h()}function y(){$(".featherlight-inner .autocomplete").empty()}function w(){let e=$(this).val();$(this).removeClass("autocompleted"),u.autocomplete.resource(e).then(e=>{if($(this).is(":focus")){let t="";for(let n of e)t+=`<li data-oid="${n.oid}">${n.name}</li>`;$(this).next().html(t)}})}function k(){if(!$(this).hasClass("autocompleted")){let e=$(this).val();u.autocomplete.resource(e).then(t=>{if(1==t.length){let e=t[0];$(this).data("oid",e.oid).val(e.name).addClass("autocompleted")}else for(let n of t)if(n.name==e){$(this).data("oid",n.oid).addClass("autocompleted");break}h()})}}async function b(){let e=[];$("#finishadding, #addresource").attr("disabled",!0),$(".featherlight-inner .content .row").each((function(){const t=$(this),n=t.find(".type").data("oid")+"|"+t.find(".type").val(),o=t.find(".numbers").val().split(/\s*,\s*/),r=t.find(".description").val();for(let t of o)e.push({id:t,type:n,description:r});t.remove()})),$(".featherlight-inner .content .well").html(await c.pullResource("WebCheckout/templates/resource_adder/console.html",{},!0));let t=u.addResources(e).then((function(){$("#cancel, #finishadding, #addresource").attr("disabled",!0),d("All Resources have been added.","success")}));t.progress((function(e,t){const n=null!=t&&t.hasOwnProperty("finishing")&&1==t.finishing||e.total-e.completed==1;switch($("#cancel").attr("disabled",n),e.completed%4){case 0:d("Resetting resource creator..");break;case 1:d(`Creating resource  ${t.data["choose-resource-id-form.resource-id"]} ..`);break;case 2:d(`Connecting type ${t.data["choose-resource-type-form.search-field"]} ..`);break;case 3:d("Finishing Resource Creation..")}let o=$(".featherlight-inner .content .progress-bar");0==e.remaining?o.parent().prev().hide():o.parent().prev().show().find("strong").text(Math.round(e.remaining)+" seconds"),o.attr("aria-valuenow",100*e.percent).width(100*e.percent+"%")})),$("#cancel").off("click").on("click",()=>{t.cancel(),$("#cancel, #finishadding, #addresource").attr("disabled",!0),$(".featherlight-inner .content .progress").hide().parent().prev().hide(),d("Cancelled. Current Resource will be revoked and any pending resources will be ignored.","error")})}class v{async _openResourceAdder(){const e=await c.pullResource("WebCheckout/templates/resource_adder/inputRow.html",{},!0);c.pullResource("WebCheckout/templates/resource_adder/index.html",{inputRow:e},!0).then((function(t){c.openLightBox(t,(function(){$("#originalform").on("click",p),$(".featherlight-inner").on("click",y).on("click",".remove-row",f).on("click",".autocomplete li",g).on("keyup",".type.form-control",w).on("blur",".type.form-control",k).on("keyup change",".form-control",h),$("#addresource").on("click",m.bind(this,e)),$("#finishadding").on("click",b)}))}))}install(){$("#new-resource-wizard").removeAttr("href").on("click",this._openResourceAdder)}}class _{async _createPersonWell(e){let t=e.phone.replace(/([0-9]{3})([0-9]{3})([0-9]{4})/,(function(e,t,n,o){return"("+t+") "+n+"-"+o}));return e.class=isNaN(e.class)?e.class:["Other","Continuing education","Undergraduate freshman","Undergraduate sophomore","Undergraduate junior","Undergraduate senior","Graduate 1","Graduate 2","Employee","Faculty"][e.class-1],e.formatedNumber=t,c.pullResource("WebCheckout/templates/new_person/index.html",e)}async _findPatronWebCheckout(e,t,n){let o=await u.autocomplete.person(e);if(null!=o&&1==o.length)t(o[0]);else{n(null!=o&&o.length>1)}}_setWebCheckoutPatron(e){return u.setPatron(e).then((function(e){$("#input-patron").css("color","black").blur().val(e.name),$(".patron-info").removeClass("hidden"),$(".patron-info-id").text(e.userid),$(".patron-info-dept").text(" Dept: "+e.department),$("#input-barcode").focus(),$.featherlight.close()}))}_searchPatron(e){let t=$("#input-patron").val();if(clearTimeout(l),t.length<=2)return $(".patron-info").addClass("hidden"),void $("#input-patron").css("color","black");isNaN(Number(t))||16!=t.length||(t=t.substring(6,15)),l=setTimeout(async()=>{this._findPatronWebCheckout(t,e=>{this._setWebCheckoutPatron(e.oid)},async e=>{try{if(e)throw"Unique identity was unable to be found";let n=await u.CoeOitApi.findUser(t),o=c.parseToDataString(n.wcoCode);$("#input-patron").css("color","black"),c.openLightBox(await this._createPersonWell(o),(function(){u.addPerson(o).then(()=>{$("#person-ticket").parent().prepend('<div class="alert alert-success"><strong>Success!</strong> User has been added!</div>'),$("#person-ticket .progress").hide(),this._findPatronWebCheckout(t,(function(e){this._setWebCheckoutPatron(e.oid)}))},e=>{$("#person-ticket").parent().prepend(`<div class="alert alert-danger"><strong>Error!</strong> ${e}</div>`)}).progress((function(e,t){$("#person-ticket .progress-bar").attr("aria-valuenow",100*e.percent).width(100*e.percent+"%")}))}))}catch(e){$("#input-patron").css("color","red"),$(".patron-info").removeClass("hidden").find(".patron-info-id").text(e)}})},!0===e?0:50)}install(){$("#input-patron").on("keyup",this._searchPatron.bind(this)),$(document).on("click",".ui-dialog-buttonset .ui-button-text",(function(){$("#input-patron").css("color","black")}))}}class C{constructor(){this.activeKeyList={},this.keyToSymbol={command:"⌘",shift:"⇧",option:"⌥",alt:"⌥"}}_setPrefix(e){this.keyPrefix=e+"+"}_key(e,t){const n=this.keyPrefix||"";let o;if(Array.isArray(e)){let r=e.reduce((e,t)=>e+n+t+",","").slice(0,-1);(o=e[0])(r,t.func)}else"string"==typeof e&&(o=e)(n+o,t.func);let r=(n+o).replace(new RegExp(Object.keys(this.keyToSymbol).join("|"),"g"),(function(e){return this.keyToSymbol[e]}));activeKeyList[r]=t.label}_createMeta(e,t){return{label:e,func:t}}_goTo(e,t){return this._createMeta(t,()=>{window.location.href=e})}_clickOn(e,t,n){if(null==n||0==n){let n=$(e);if(1==n.length)return this.createMeta(t,()=>n[0].click());if(n.length>1)throw new Error("Can not identify a unique clickable element.");return this.createMeta(t,()=>{})}return this.createMeta(t,()=>{let t=$(e);if(1==t.length&&t[0].click(),t.length>1)throw new Error("Can not identify a unique clickable element.")})}_removeFilter(){key.filter=function(){return!0}}_installRedirects(){this._setPrefix("ctrl+shift"),this._key("c",this._goTo("?method=checkout-jump","Checkout")),this._key("r",this._goTo("?method=reservation-jump","Reservation")),this._key("p",this._goTo("?method=find-reservations","Pickup")),this._key("f",this._goTo("?method=find-checkouts","Find Checkouts")),this._key("q",this._goTo("?method=rapid-return","Quick Return"))}_installClicks(){this._setPrefix("ctrl"),this._key("c",this._clickOn("#commit-button .submit-all","Checkout")),this._key("c",this._clickOn("button:contains('Confirm Checkout')","Confirm Checkout",!0)),this._key(["t","b"],this._clickOn("button:contains('Timeline Scheduler')","Back to Checkout",!0)),this._key("r",this._clickOn("button:contains('Reset')","Reset Checkout"))}install(){localStorage.setItem("list",JSON.stringify(this.activeKeyList)),$("#statusBar .rightStatusBar").append("SOMETHING NEW"),this._removeFilter(),this._installRedirects(),this._installClicks()}}!function(e){function t(e){const t=new e;if(e.hasOwnProperty("install")){let t=e.constructor.name;console.error(`Module "${t}": Could not be installed due to missing install method.`)}else t.install()}e(document).ready((function(){t(o),t(v),t(_),t(C)}));let n=document.createElement("script");n.src=chrome.extension.getURL("WebCheckout/inject.js"),(document.head||document.documentElement).appendChild(n)}(jQuery)}]);